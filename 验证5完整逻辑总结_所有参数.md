# 验证5完整逻辑总结 - 所有黄金点位与参数

**版本**: v3.0 Complete
**日期**: 2026-01-22
**状态**: ✅ 已验证与验证5完全一致

---

## 🎯 核心参数总结（所有黄金点位）

### 第1层：物理指标计算参数

```python
# FFT滤波参数
FFT_COMPONENTS = 8          # 保留前8个频率分量（关键！）
FFT_WINDOW_SIZE = 100       # 计算窗口大小

# 张力参数
TENSION_NORMALIZATION = True # 是否标准化
TENSION_MEAN = 0.0          # 标准化后的均值
TENSION_STD = 1.0           # 标准化后的标准差

# 加速度计算
ACCELERATION_METHOD = "second_order_difference"  # 二阶差分
MIN_DATA_POINTS = 3         # 计算加速度的最小数据点
```

**关键点**：
- **FFT_COMPONENTS = 8**：这是验证5的核心！保留前8个低频分量，去除高频噪音
- **二阶差分**：加速度 = 张力的二阶差分，不是价格变化率的变化率

---

### 第2层：市场状态诊断参数（黄金点位）

```python
# === 核心阈值（验证5的关键参数） ===
TENSION_THRESHOLD = 0.35    # 张力阈值（最重要的点位！）
ACCEL_THRESHOLD = 0.02      # 加速度阈值（第二重要！）
OSCILLATION_BAND = 0.5      # 震荡带宽度

# === 辅助阈值 ===
HIGH_OSCILLATION_TENSION = 0.3    # 高位震荡张力阈值
LOW_OSCILLATION_TENSION = -0.3    # 低位震荡张力阈值
OSCILLATION_ACCEL = 0.01          # 震荡加速度阈值
```

**这些是验证5的黄金点位！**

---

### 第3层：置信度等级

```python
# === 奇点看空（BEARISH_SINGULARITY） ===
置信度等级:
  - 强奇点看空（宏观失速）: 0.9   # 条件：tension>0.35, acc<-0.02, dxy_fuel>0.1
  - 奇点看空（动力失速）: 0.7     # 条件：tension>0.35, acc<-0.02, dxy_fuel<=0.1

# === 奇点看涨（BULLISH_SINGULARITY） ===
置信度等级:
  - 超强奇点看涨（燃料爆炸）: 0.95 # 条件：tension<-0.35, acc>0.02, dxy_fuel>0.2
  - 强奇点看涨（动力回归）: 0.8    # 条件：tension<-0.35, acc>0.02, 0<dxy_fuel<=0.2
  - 奇点看涨（弹性释放）: 0.6      # 条件：tension<-0.35, acc>0.02, dxy_fuel<=0

# === 震荡状态 ===
置信度等级:
  - 系统平衡（震荡收敛）: 0.8      # 条件：|tension|<0.5, |acc|<0.02
  - 高位震荡（风险积聚）: 0.6      # 条件：tension>0.3, |acc|<0.01
  - 低位震荡（机会积聚）: 0.6      # 条件：tension<-0.3, |acc|<0.01

# === 过渡状态 ===
置信度等级:
  - 向上过渡（蓄力）: 0.4          # 条件：tension>0, acc>0
  - 向下过渡（泄力）: 0.4          # 条件：tension<0, acc<0
  - 体制切换中: 0.3                # 其他情况
```

---

### 第4层：DXY燃料参数

```python
# DXY燃料阈值
DXY_FUEL_HIGH = 0.2         # 高燃料阈值（增强信号）
DXY_FUEL_MEDIUM = 0.1       # 中等燃料阈值
DXY_FUEL_LOW = 0.0          # 低燃料阈值

# DXY燃料计算
DXY_FUEL_MULTIPLIER = 100   # DXY燃料 = -加速度 × 100
DXY_WINDOW = 5              # DXY计算窗口（最近5个数据点）
```

---

### 第5层：交易决策参数（V8.0反向策略）

```python
# === 基础仓位计算 ===
BASE_POSITION_MIN = 0.8      # 最小基础仓位
BASE_POSITION_MAX = 1.5      # 最大基础仓位
CONFIDENCE_BASE = 0.6        # 基础置信度
CONFIDENCE_STEP = 0.5        # 置信度到仓位的转换系数

# 仓位公式：
# base_size = 1.0 + (confidence - 0.6) × 0.5
# 例如：
#   - 置信度0.6 → 1.0 (100%)
#   - 置信度0.8 → 1.1 (110%)
#   - 置信度0.95 → 1.175 (117.5%)

# === DXY增强参数 ===
DXY_ENHANCEMENT_THRESHOLD = 0.2  # DXY增强阈值
DXY_ENHANCEMENT_MULTIPLIER = 1.2  # DXY增强倍数（增加20%仓位）
```

---

### 第6层：风险管理参数

```python
# === 止损止盈 ===
STOP_LOSS_PCT = 0.03        # 止损：-3%
TAKE_PROFIT_PCT = 0.10      # 止盈：+10%
RISK_REWARD_RATIO = 3.33     # 盈亏比：10/3 = 3.33:1

# === 仓位控制 ===
RISK_PER_TRADE = 0.02       # 单笔风险：2% of account
MAX_POSITION_BY_RISK = account_balance × (risk_per_trade / stop_loss_pct)
                         = account_balance × (0.02 / 0.03)
                         = account_balance × 0.667
                         # 即最大仓位为账户的66.7%

# === 信号消失检测 ===
SIGNAL_DISAPPEARED_THRESHOLD = 0.5  # 信号消失阈值（置信度<50%）
```

---

### 第7层：数据获取参数

```python
# === BTC数据 ===
BTC_SYMBOL = "BTCUSDT"
BTC_INTERVAL = "4h"          # 4小时K线
BTC_LIMIT = 1000             # 获取1000条K线
BTC_MIN_POINTS = 60          # 最少需要60个数据点

# === DXY数据 ===
DXY_SERIES_ID = "DTWEXBGS"   # FRED数据库DXY系列ID
DXY_DAYS_BACK = 30           # 获取最近30天数据
DXY_WINDOW = 5               # 计算窗口（最近5个点）
```

---

## 📊 完整决策树（所有逻辑）

### 决策流程图

```
┌─────────────────────────────────────────┐
│  第0层：数据获取                          │
│  ├─ BTC 4小时K线（1000条）               │
│  └─ DXY美元指数（30天）                  │
└─────────────────────────────────────────┘
                ↓
┌─────────────────────────────────────────┐
│  第1层：物理指标计算                      │
│  ├─ 去趋势：detrend(prices)             │
│  ├─ FFT滤波：coeffs[8:] = 0             │
│  ├─ Hilbert变换：tension = imag(hilbert)│
│  ├─ 标准化：(tension - mean) / std      │
│  └─ 加速度：张力的二阶差分               │
│      velocity = tension[i] - tension[i-1]│
│      acceleration = velocity - (tension[i-1] - tension[i-2]) │
└─────────────────────────────────────────┘
                ↓
┌─────────────────────────────────────────┐
│  第2层：市场状态诊断                      │
│                                          │
│  【判断顺序】                             │
│  1. BEARISH_SINGULARITY?                 │
│     条件：tension > 0.35 AND acc < -0.02│
│     ├─ dxy_fuel > 0.1 → 置信度0.9       │
│     └─ dxy_fuel <= 0.1 → 置信度0.7      │
│                                          │
│  2. BULLISH_SINGULARITY?                 │
│     条件：tension < -0.35 AND acc > 0.02│
│     ├─ dxy_fuel > 0.2 → 置信度0.95      │
│     ├─ 0 < dxy_fuel <= 0.2 → 置信度0.8  │
│     └─ dxy_fuel <= 0 → 置信度0.6        │
│                                          │
│  3. OSCILLATION?                         │
│     条件：|tension| < 0.5 AND |acc| < 0.02│
│     → 置信度0.8                         │
│                                          │
│  4. HIGH_OSCILLATION?                    │
│     条件：tension > 0.3 AND |acc| < 0.01 │
│     → 置信度0.6                         │
│                                          │
│  5. LOW_OSCILLATION?                     │
│     条件：tension < -0.3 AND |acc| < 0.01│
│     → 置信度0.6                         │
│                                          │
│  6. TRANSITION?                          │
│     ├─ tension > 0 AND acc > 0 → 0.4    │
│     ├─ tension < 0 AND acc < 0 → 0.4    │
│     └─ 其他 → 0.3                       │
└─────────────────────────────────────────┘
                ↓
        【置信度过滤】
        confidence >= 0.6?
                ↓
           YES → 继续
           NO → 观望
                ↓
┌─────────────────────────────────────────┐
│  第3层：V8.0反向策略决策                  │
│                                          │
│  【策略映射】                             │
│  BEARISH_SINGULARITY → LONG  (反向抄底)  │
│  BULLISH_SINGULARITY → SHORT (反向逃顶)  │
│  LOW_OSCILLATION → LONG    (低位做多)    │
│  HIGH_OSCILLATION → SHORT   (高位做空)   │
│  OSCILLATION → WAIT      (震荡观望)     │
│  TRANSITION → WAIT       (过渡观望)      │
└─────────────────────────────────────────┘
                ↓
┌─────────────────────────────────────────┐
│  第4层：仓位计算                          │
│                                          │
│  1. 基础仓位：                            │
│     base_size = 1.0 + (confidence - 0.6) × 0.5│
│                                          │
│  2. DXY增强：                             │
│     if dxy_fuel > 0.2:                   │
│         base_size *= 1.2  # 增加20%     │
│                                          │
│  3. 风险控制：                             │
│     max_position = account × (0.02 / 0.03)│
│                  = account × 0.667       │
│     actual_position = min(strategy, max)│
└─────────────────────────────────────────┘
                ↓
┌─────────────────────────────────────────┐
│  第5层：风险管理与执行                    │
│                                          │
│  开仓参数：                                │
│  ├─ 入场价：current_price                │
│  ├─ 止损：entry × (1 ∓ 0.03)            │
│  ├─ 止盈：entry × (1 ± 0.10)            │
│  └─ 仓位：actual_position               │
│                                          │
│  平仓条件：                                │
│  ├─ 止损触发：pnl < -3%                  │
│  ├─ 止盈触发：pnl > +10%                 │
│  └─ 信号消失：confidence < 0.5           │
└─────────────────────────────────────────┘
```

---

## 🎯 所有信号类型详解

### 1. BEARISH_SINGULARITY（奇点看空）

**触发条件**：
```python
tension > 0.35 AND acceleration < -0.02
```

**物理意义**：
- 张力 > 0.35：价格被大幅拉高（严重超买）
- 加速度 < -0.02：上升速度在快速减慢（涨势衰竭）

**市场状态**：
- 价格快速上涨后，动能突然衰竭
- 可能是FOMO情绪推动的泡沫
- 随时可能大幅回调

**我们的策略**：**反向做多（抄底）**

**置信度等级**：
- 强奇点看空（宏观失速）：0.9
  - 条件：DXY燃料 > 0.1
  - 说明：美元走弱 + 价格超买 = 宏观失速
- 奇点看空（动力失速）：0.7
  - 条件：DXY燃料 <= 0.1
  - 说明：单纯的动能衰竭

**仓位**：
- 基础：100% - 115%（根据置信度）
- DXY增强：如果有DXY燃料，增加20%

---

### 2. BULLISH_SINGULARITY（奇点看涨）

**触发条件**：
```python
tension < -0.35 AND acceleration > 0.02
```

**物理意义**：
- 张力 < -0.35：价格被大幅压低（严重超卖）
- 加速度 > 0.02：下降速度在减慢（跌势衰竭）

**市场状态**：
- 价格快速下跌后，动能突然衰竭
- 可能是恐慌性抛售
- 随时可能大幅反弹

**我们的策略**：**反向做空（逃顶）**

**置信度等级**：
- 超强奇点看涨（燃料爆炸）：0.95
  - 条件：DXY燃料 > 0.2
  - 说明：美元加速走弱 + 价格超卖 = 燃料爆炸
- 强奇点看涨（动力回归）：0.8
  - 条件：0 < DXY燃料 <= 0.2
  - 说明：美元微弱走弱 + 价格超卖 = 动力回归
- 奇点看涨（弹性释放）：0.6
  - 条件：DXY燃料 <= 0
  - 说明：单纯的弹性释放

**仓位**：
- 基础：100% - 118%（根据置信度）
- DXY增强：如果有DXY燃料，增加20%

---

### 3. OSCILLATION（系统平衡）

**触发条件**：
```python
|tension| < 0.5 AND |acceleration| < 0.02
```

**物理意义**：
- 张力接近0：价格在均衡位置附近
- 加速度接近0：没有明显的动量

**市场状态**：
- 价格在一个区间内波动
- 没有明确的方向
- 不适合交易

**我们的策略**：**观望**

**置信度**：0.8（虽然置信度高，但不交易）

---

### 4. HIGH_OSCILLATION（高位震荡）

**触发条件**：
```python
tension > 0.3 AND |acceleration| < 0.01
```

**物理意义**：
- 张力为正：价格在均衡上方
- 加速度很小：没有明显动量

**市场状态**：
- 价格在高位横盘
- 可能在积聚风险
- 随时可能下跌

**我们的策略**：**做空（高位做空）**

**置信度**：0.6

**仓位**：100%

---

### 5. LOW_OSCILLATION（低位震荡）

**触发条件**：
```python
tension < -0.3 AND |acceleration| < 0.01
```

**物理意义**：
- 张力为负：价格在均衡下方
- 加速度很小：没有明显动量

**市场状态**：
- 价格在低位横盘
- 可能在积聚机会
- 随时可能上涨

**我们的策略**：**做多（低位做多）**

**置信度**：0.6

**仓位**：100%

---

### 6. TRANSITION（过渡状态）

**触发条件**：
```python
# 不满足以上任何条件
```

**子类型**：
- TRANSITION_UP：tension > 0 AND acceleration > 0（向上过渡）
- TRANSITION_DOWN：tension < 0 AND acceleration < 0（向下过渡）

**市场状态**：
- 市场正在切换状态
- 从一种状态转向另一种状态

**我们的策略**：**观望**

**置信度**：0.3 - 0.4（太低，不交易）

---

## 📈 完整交易逻辑总结

### 核心原理

**V8.0反向策略**："系统看空我做多，系统看涨我做空"

**为什么有效？**
1. 市场在极端状态下会出现过度反应
2. 过度反应后会回归均值
3. 逆向思维可以捕捉反向机会

### 完整决策矩阵

| 系统信号 | 市场状态 | 我们的行动 | 仓位 | 理由 |
|---------|---------|-----------|------|------|
| BEARISH_SINGULARITY | 奇点看空（超买） | **LONG** | 100%-138% | 反向抄底 |
| BULLISH_SINGULARITY | 奇点看涨（超卖） | **SHORT** | 100%-141% | 反向逃顶 |
| LOW_OSCILLATION | 低位震荡 | **LONG** | 100% | 低位做多 |
| HIGH_OSCILLATION | 高位震荡 | **SHORT** | 100% | 高位做空 |
| OSCILLATION | 震荡 | **WAIT** | 0% | 观望 |
| TRANSITION | 过渡 | **WAIT** | 0% | 观望 |

**注**：DXY增强会在基础仓位上增加20%

---

## 🎯 黄金点位速查表

### 核心阈值（必须记住！）

```python
# === 最重要 ===
TENSION_THRESHOLD = 0.35     # 张力阈值（#1重要！）
ACCEL_THRESHOLD = 0.02       # 加速度阈值（#2重要！）

# === 重要 ===
OSCILLATION_BAND = 0.5       # 震荡带
CONFIDENCE_THRESHOLD = 0.6    # 置信度阈值

# === DXY ===
DXY_FUEL_HIGH = 0.2          # DXY高燃料
DXY_FUEL_MEDIUM = 0.1        # DXY中燃料

# === 风险管理 ===
STOP_LOSS_PCT = 0.03         # 止损3%
TAKE_PROFIT_PCT = 0.10       # 止盈10%
RISK_PER_TRADE = 0.02        # 单笔风险2%
```

### 关键公式（必须记住！）

```python
# === 张力计算 ===
1. 去趋势：detrend(prices)
2. FFT滤波：coeffs[8:] = 0
3. Hilbert变换：tension = imag(hilbert(filtered))
4. 标准化：norm = (tension - mean) / std

# === 加速度计算（验证5核心！） ===
velocity = tension[i] - tension[i-1]
acceleration = velocity - (tension[i-1] - tension[i-2])
            = tension[i] - 2×tension[i-1] + tension[i-2]

# === DXY燃料 ===
dxy_fuel = -dxy_acceleration × 100

# === 仓位计算 ===
base_size = 1.0 + (confidence - 0.6) × 0.5
max_position = account × (0.02 / 0.03) = account × 0.667
```

---

## 🚀 快速决策指南

### 当你看到这些信号时...

#### 场景1：张力 > 0.35 且加速度 < -0.02
```
→ BEARISH_SINGULARITY（奇点看空）
→ 我们做多（反向抄底）
→ 仓位：100% - 138%
→ 理由：市场超买且动能衰竭，可能回调
```

#### 场景2：张力 < -0.35 且加速度 > 0.02
```
→ BULLISH_SINGULARITY（奇点看涨）
→ 我们做空（反向逃顶）
→ 仓位：100% - 141%
→ 理由：市场超卖且动能衰竭，可能反弹
```

#### 场景3：|张力| < 0.5 且 |加速度| < 0.02
```
→ OSCILLATION（震荡）
→ 我们观望
→ 理由：市场震荡，没有明确方向
```

#### 场景4：DXY燃料 > 0.2
```
→ DXY加速走弱（美元变弱）
→ 增强做多信号（增加20%仓位）
→ 理由：美元弱 → BTC强
```

#### 场景5：DXY燃料 < -0.2
```
→ DXY加速走强（美元变强）
→ 增强做空信号（增加20%仓位）
→ 理由：美元强 → BTC弱
```

---

## ✅ 总结

### 所有关键参数

| 参数 | 值 | 重要性 | 说明 |
|------|---|--------|------|
| TENSION_THRESHOLD | 0.35 | ⭐⭐⭐⭐⭐ | 张力阈值，最核心 |
| ACCEL_THRESHOLD | 0.02 | ⭐⭐⭐⭐⭐ | 加速度阈值，第二核心 |
| OSCILLATION_BAND | 0.5 | ⭐⭐⭐⭐ | 震荡带宽度 |
| FFT_COMPONENTS | 8 | ⭐⭐⭐⭐ | FFT保留频率分量 |
| CONFIDENCE_THRESHOLD | 0.6 | ⭐⭐⭐⭐ | 置信度过滤阈值 |
| DXY_FUEL_HIGH | 0.2 | ⭐⭐⭐ | DXY高燃料阈值 |
| STOP_LOSS_PCT | 0.03 | ⭐⭐⭐⭐⭐ | 止损3% |
| TAKE_PROFIT_PCT | 0.10 | ⭐⭐⭐⭐⭐ | 止盈10% |
| RISK_PER_TRADE | 0.02 | ⭐⭐⭐⭐⭐ | 单笔风险2% |

### 核心公式

1. **张力**：FFT滤波 → Hilbert变换 → 标准化
2. **加速度**：张力的二阶差分（关键！）
3. **DXY燃料**：-DXY加速度 × 100
4. **仓位**：1.0 + (confidence - 0.6) × 0.5
5. **风险控制**：account × (0.02 / 0.03) = account × 0.667

### 完整逻辑

**一句话总结**：

> 基于FFT滤波和Hilbert变换计算市场张力，通过二阶差分检测加速度突变（验证5核心），结合DXY燃料增强信号，采用V8.0反向策略在市场过度反应时进行逆向交易，止损3%、止盈10%，单笔风险控制在2%。

---

**这就是验证5的完整逻辑和所有黄金点位！** 🎯
